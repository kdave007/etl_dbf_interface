<nb-card>
  <nb-card-header>
    <div class="header-content">
      <h5>Active Connections</h5>
      <div class="header-actions">
        <div class="search-box">
          <input nbInput 
                 type="text" 
                 placeholder="Search connections..." 
                 [(ngModel)]="searchTerm"
                 (ngModelChange)="filterConnections()">
          <nb-icon icon="search-outline"></nb-icon>
        </div>
        <button nbButton
                size="small"
                status="primary"
                [disabled]="isLoading"
                (click)="refreshData()"
                title="Actualizar datos">
          <nb-icon icon="refresh-outline" [class.spinning]="isLoading"></nb-icon>
          Actualizar
        </button>
      </div>
    </div>
  </nb-card-header>
  <nb-card-body>
    <div class="table-container">
      <table class="connections-table">
        <thead>
          <tr>
            <th>Client ID</th>
            <th>Sucursal</th>
            <th>Plaza</th>
            <th>Estatus</th>
            <th>Ultima conexi√≥n</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let conn of paginatedConnections" class="table-row">
            <td>{{ conn.client_id }}</td>
            <td>{{ conn.location }}</td>
            <td class="city-cell">{{ conn.city }}</td>
            <td>
              <span class="status-badge" [ngClass]="getStatusClass(conn.status || 'Disconnected')">
                <nb-icon [icon]="getStatusIcon(conn.status || 'Disconnected')"></nb-icon>
                {{ conn.status || 'Disconnected' }}
              </span>
            </td>
            <td>{{ formatLastSeen(conn.last_seen) }}</td>
          </tr>
        </tbody>
      </table>
      <div *ngIf="filteredConnections.length === 0" class="no-data">
        <nb-icon icon="inbox-outline"></nb-icon>
        <p>No connections found</p>
      </div>
      
      <!-- Pagination Controls -->
      <app-table-pagination
        [currentPage]="currentPage"
        [pageSize]="pageSize"
        [totalRecords]="filteredConnections.length"
        (pageChange)="onPageChange($event)">
      </app-table-pagination>
    </div>
  </nb-card-body>
</nb-card>
