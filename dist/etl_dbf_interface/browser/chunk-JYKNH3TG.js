import{a as de}from"./chunk-UYYT4DMW.js";import{a as I}from"./chunk-2QZCQHLA.js";import{a as pe}from"./chunk-6E5HW3VG.js";import"./chunk-P75U6W4R.js";import{a as ce}from"./chunk-IZPHESO7.js";import{$ as h,B as o,Ca as oe,Cb as j,D as $,Da as z,Db as U,E as w,Eb as H,G as g,Ga as k,H as q,I as c,J as ee,K as te,L as l,M as r,Ma as O,N as b,O as M,P as m,Q as d,Qa as V,Ra as F,Ta as E,V as p,Va as B,Wa as D,X as x,Xa as L,Y as ne,Ya as S,_ as C,a as y,aa as _,b as R,ba as ie,ia as N,ja as T,la as v,n as Q,oa as ae,p as J,s as Y,sb as le,t as u,tb as W,u as f,ub as re,vb as se,x as A}from"./chunk-LRQEKKHY.js";var he=()=>[];function _e(i,t){i&1&&b(0,"nb-icon",15)}function xe(i,t){if(i&1&&(l(0,"nb-option",16),p(1),r()),i&2){let e=t.$implicit;c("value",e.value),o(),x(" ",e.label," ")}}function ye(i,t){if(i&1){let e=M();l(0,"div",7)(1,"div",8)(2,"label",9),p(3,"Buscar"),r(),g(4,_e,1,0,"nb-icon",10),r(),l(5,"div",11)(6,"nb-select",12),_("selectedChange",function(a){u(e);let s=d();return h(s.selectedField,a)||(s.selectedField=a),f(a)}),m("selectedChange",function(){u(e);let a=d();return f(a.onFieldChange())}),g(7,xe,2,2,"nb-option",13),r(),l(8,"input",14),_("ngModelChange",function(a){u(e);let s=d();return h(s.searchText,a)||(s.searchText=a),f(a)}),m("ngModelChange",function(){u(e);let a=d();return f(a.onSearchChange())}),r()()()}if(i&2){let e=d();o(4),c("ngIf",e.config.lockTextFilter),o(2),C("selected",e.selectedField),c("disabled",e.config.lockTextFilter||!1),o(),c("ngForOf",e.config.fields||ie(6,he)),o(),C("ngModel",e.searchText),c("disabled",e.config.lockTextFilter||!1)}}function Me(i,t){i&1&&b(0,"nb-icon",15)}function Pe(i,t){if(i&1){let e=M();l(0,"div",7)(1,"div",8)(2,"label",9),p(3,"Rango de Fechas"),r(),g(4,Me,1,0,"nb-icon",10),r(),l(5,"div",17)(6,"input",18),_("ngModelChange",function(a){u(e);let s=d();return h(s.dateRange.start,a)||(s.dateRange.start=a),f(a)}),m("ngModelChange",function(){u(e);let a=d();return f(a.onDateRangeChange())}),r(),l(7,"span",19),p(8,"-"),r(),l(9,"input",20),_("ngModelChange",function(a){u(e);let s=d();return h(s.dateRange.end,a)||(s.dateRange.end=a),f(a)}),m("ngModelChange",function(){u(e);let a=d();return f(a.onDateRangeChange())}),r()()()}if(i&2){let e=d();o(4),c("ngIf",e.config.lockDateFilter),o(2),C("ngModel",e.dateRange.start),c("disabled",e.config.lockDateFilter||!1),o(3),C("ngModel",e.dateRange.end),c("disabled",e.config.lockDateFilter||!1)}}function we(i,t){if(i&1){let e=M();l(0,"button",21),m("click",function(){u(e);let a=d();return f(a.applyFilters())}),b(1,"nb-icon",22),p(2," Aplicar Filtros "),r()}}var X=class i{config={showTextFilter:!0,showDateFilter:!0,lockTextFilter:!1,lockDateFilter:!1,fields:[],defaultDateRange:{start:null,end:null},manualApply:!1};filterChange=new A;searchText="";selectedField="";dateRange={start:null,end:null};ngOnInit(){this.config.fields&&this.config.fields.length>0&&(this.selectedField=this.config.fields[0].value),this.config.defaultDateRange&&(this.dateRange=y({},this.config.defaultDateRange)),this.config.manualApply||this.emitFilterChange()}onSearchChange(){this.config.manualApply||this.emitFilterChange()}onFieldChange(){this.config.manualApply||this.emitFilterChange()}onDateRangeChange(){this.config.manualApply||this.emitFilterChange()}applyFilters(){this.emitFilterChange()}clearFilters(){this.config.lockTextFilter||(this.searchText="",this.config.fields&&this.config.fields.length>0&&(this.selectedField=this.config.fields[0].value)),this.config.lockDateFilter||(this.dateRange={start:null,end:null}),this.emitFilterChange()}emitFilterChange(){this.filterChange.emit({searchText:this.searchText,selectedField:this.selectedField,dateRange:y({},this.dateRange)})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=w({type:i,selectors:[["app-advanced-filter"]],inputs:{config:"config"},outputs:{filterChange:"filterChange"},decls:10,vars:3,consts:[[1,"filter-card"],[1,"filters-container"],["class","filter-group",4,"ngIf"],[1,"filter-actions"],["nbButton","","size","small","status","primary",3,"click",4,"ngIf"],["nbButton","","size","small","status","basic",3,"click"],["icon","close-outline"],[1,"filter-group"],[1,"filter-header"],[1,"filter-label"],["icon","lock-outline","class","lock-icon",4,"ngIf"],[1,"filter-inputs"],["placeholder","Campo",1,"field-selector",3,"selectedChange","selected","disabled"],[3,"value",4,"ngFor","ngForOf"],["nbInput","","placeholder","Buscar...",1,"search-input",3,"ngModelChange","ngModel","disabled"],["icon","lock-outline",1,"lock-icon"],[3,"value"],[1,"filter-inputs","date-inputs"],["nbInput","","type","date","placeholder","Fecha Inicio",1,"date-input",3,"ngModelChange","ngModel","disabled"],[1,"date-separator"],["nbInput","","type","date","placeholder","Fecha Fin",1,"date-input",3,"ngModelChange","ngModel","disabled"],["nbButton","","size","small","status","primary",3,"click"],["icon","checkmark-outline"]],template:function(e,n){e&1&&(l(0,"nb-card",0)(1,"nb-card-body")(2,"div",1),g(3,ye,9,7,"div",2)(4,Pe,10,5,"div",2),l(5,"div",3),g(6,we,3,0,"button",4),l(7,"button",5),m("click",function(){return n.clearFilters()}),b(8,"nb-icon",6),p(9," Limpiar "),r()()()()()),e&2&&(o(3),c("ngIf",n.config.showTextFilter),o(),c("ngIf",n.config.showDateFilter),o(2),c("ngIf",n.config.manualApply))},dependencies:[v,N,T,O,oe,z,k,D,B,E,H,U,j,W,le,S,L,F,V,I],styles:[".filter-card[_ngcontent-%COMP%]{margin-bottom:1.5rem;min-height:100px}.filter-card[_ngcontent-%COMP%]   nb-card-body[_ngcontent-%COMP%]{padding:1.25rem 1.5rem}.filters-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1.5rem;align-items:flex-start;contain:layout style}.filter-group[_ngcontent-%COMP%]{flex:1;min-width:250px;display:flex;flex-direction:column;gap:.5rem}.filter-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.filter-header[_ngcontent-%COMP%]   .filter-label[_ngcontent-%COMP%]{font-weight:600;color:#fff;font-size:.875rem;white-space:nowrap}.filter-header[_ngcontent-%COMP%]   .lock-icon[_ngcontent-%COMP%]{color:#fa0;font-size:1rem}.filter-inputs[_ngcontent-%COMP%]{display:flex;gap:.75rem;align-items:center}.filter-inputs.date-inputs[_ngcontent-%COMP%]   .date-input[_ngcontent-%COMP%]{flex:1}.filter-inputs.date-inputs[_ngcontent-%COMP%]   .date-separator[_ngcontent-%COMP%]{color:#a4abb3;font-weight:500}.field-selector[_ngcontent-%COMP%]{min-width:150px;max-width:200px}.search-input[_ngcontent-%COMP%]{flex:1;min-width:200px}.date-input[_ngcontent-%COMP%]{cursor:pointer}.filter-actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:.75rem;width:100%;margin-top:1rem;padding-top:1rem;border-top:1px solid rgba(255,255,255,.1)}.filter-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;white-space:nowrap}.filter-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   nb-icon[_ngcontent-%COMP%]{font-size:1rem}@media (max-width: 768px){.filters-container[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.filter-group[_ngcontent-%COMP%]{min-width:100%}.filter-inputs[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.filter-inputs.date-inputs[_ngcontent-%COMP%]   .date-separator[_ngcontent-%COMP%]{display:none}.field-selector[_ngcontent-%COMP%], .search-input[_ngcontent-%COMP%]{max-width:100%;width:100%}.filter-actions[_ngcontent-%COMP%]{width:100%}.filter-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;justify-content:center}}[_nghost-%COMP%]     nb-select .select-button{background-color:#1a1a2e;border-color:#fff3;color:#fff}[_nghost-%COMP%]     nb-select .select-button:hover{border-color:#ffffff4d}[_nghost-%COMP%]     nb-select .select-button:disabled{opacity:.5;cursor:not-allowed}[_nghost-%COMP%]     input[nbInput]{background-color:#1a1a2e;border-color:#fff3;color:#fff}[_nghost-%COMP%]     input[nbInput]::placeholder{color:#a4abb3}[_nghost-%COMP%]     input[nbInput]:hover{border-color:#ffffff4d}[_nghost-%COMP%]     input[nbInput]:focus{border-color:#36f}[_nghost-%COMP%]     input[nbInput]:disabled{opacity:.5;cursor:not-allowed}"]})};function Te(i,t){if(i&1&&(l(0,"nb-option",15),p(1),r()),i&2){let e=t.$implicit;c("value",e.value),o(),x(" ",e.label," ")}}function ve(i,t){if(i&1){let e=M();l(0,"div",12)(1,"label"),p(2,"Tabla:"),r(),l(3,"nb-select",13),_("ngModelChange",function(a){u(e);let s=d();return h(s.selectedTable,a)||(s.selectedTable=a),f(a)}),m("ngModelChange",function(){u(e);let a=d();return f(a.onTableChange())}),g(4,Te,2,2,"nb-option",14),r()()}if(i&2){let e=d();o(3),C("ngModel",e.selectedTable),o(),c("ngForOf",e.tableOptions)}}function Oe(i,t){if(i&1){let e=M();l(0,"button",16),m("click",function(){u(e);let a=d();return f(a.toggleColumnVisibility())}),b(1,"nb-icon",17),p(2),r()}if(i&2){let e=d();o(),c("icon",e.showAll?"collapse-outline":"expand-outline"),o(),x(" ",e.showAll?"Mostrar Menos":"Mostrar Todas"," ")}}function Fe(i,t){if(i&1&&(l(0,"th"),p(1),r()),i&2){let e=t.$implicit;ee("width",e.width),o(),x(" ",e.label," ")}}function De(i,t){if(i&1&&(l(0,"td"),p(1),r()),i&2){let e=t.$implicit,n=d().$implicit,a=d();o(),x(" ",a.formatValue(a.getCellValue(n,e),e.type)," ")}}function Se(i,t){if(i&1&&(l(0,"tr"),g(1,De,2,1,"td",10),r()),i&2){let e=d();o(),c("ngForOf",e.visibleColumns)}}function Ie(i,t){if(i&1&&(l(0,"tr")(1,"td",18),p(2," No hay datos disponibles "),r()()),i&2){let e=d();o(),q("colspan",e.visibleColumns.length)}}var Z=class i{columns=[];data=[];showAllColumns=!1;defaultVisibleColumns=10;tableOptions=[];selectedTable="";tableChange=new A;visibleColumns=[];showAll=!1;ngOnInit(){this.showAll=this.showAllColumns,this.updateVisibleColumns()}ngOnChanges(t){t.columns&&this.updateVisibleColumns()}updateVisibleColumns(){this.showAll?this.visibleColumns=[...this.columns]:this.visibleColumns=this.columns.slice(0,this.defaultVisibleColumns)}toggleColumnVisibility(){this.showAll=!this.showAll,this.updateVisibleColumns()}getCellValue(t,e){return t[e.key]}formatValue(t,e){if(t==null)return"-";switch(e){case"date":return new Date(t).toLocaleDateString();case"boolean":return t?"S\xED":"No";case"number":return typeof t=="number"?t.toLocaleString():t;default:return String(t)}}onTableChange(){this.tableChange.emit(this.selectedTable)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=w({type:i,selectors:[["app-dynamic-table"]],inputs:{columns:"columns",data:"data",showAllColumns:"showAllColumns",defaultVisibleColumns:"defaultVisibleColumns",tableOptions:"tableOptions",selectedTable:"selectedTable"},outputs:{tableChange:"tableChange"},features:[Y],decls:17,vars:10,consts:[[1,"dynamic-table-wrapper"],[1,"table-header"],[1,"table-info"],["class","table-selector",4,"ngIf"],[1,"record-count"],[1,"column-count"],["nbButton","","size","small","status","basic",3,"click",4,"ngIf"],[1,"table-container"],[1,"dynamic-table"],[3,"width",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"table-selector"],["size","small","placeholder","Seleccionar tabla",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["nbButton","","size","small","status","basic",3,"click"],[3,"icon"],[1,"no-data"]],template:function(e,n){e&1&&(l(0,"div",0)(1,"div",1)(2,"div",2),g(3,ve,5,2,"div",3),l(4,"span",4),p(5),r(),l(6,"span",5),p(7),r()(),g(8,Oe,3,2,"button",6),r(),l(9,"div",7)(10,"table",8)(11,"thead")(12,"tr"),g(13,Fe,2,3,"th",9),r()(),l(14,"tbody"),g(15,Se,2,1,"tr",10)(16,Ie,3,1,"tr",11),r()()()()),e&2&&(o(3),c("ngIf",n.tableOptions.length>0),o(2),x("",n.data.length," registros"),o(2),ne("",n.visibleColumns.length," / ",n.columns.length," columnas"),o(),c("ngIf",n.columns.length>n.defaultVisibleColumns),o(),te("scrollable",n.showAll),o(4),c("ngForOf",n.visibleColumns),o(2),c("ngForOf",n.data),o(),c("ngIf",n.data.length===0))},dependencies:[v,N,T,O,z,k,D,S,L,F,V,H,U,j,I],styles:[".dynamic-table-wrapper[_ngcontent-%COMP%]{width:100%}.table-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:1rem;padding:1rem 0;margin-bottom:1rem;border-bottom:1px solid rgba(255,255,255,.1)}.table-header[_ngcontent-%COMP%]   .table-info[_ngcontent-%COMP%]{display:flex;gap:1.5rem;align-items:center;flex-wrap:wrap}.table-header[_ngcontent-%COMP%]   .table-info[_ngcontent-%COMP%]   .table-selector[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.table-header[_ngcontent-%COMP%]   .table-info[_ngcontent-%COMP%]   .table-selector[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#fff;font-size:.875rem;white-space:nowrap}.table-header[_ngcontent-%COMP%]   .table-info[_ngcontent-%COMP%]   .table-selector[_ngcontent-%COMP%]   nb-select[_ngcontent-%COMP%]{min-width:150px}.table-header[_ngcontent-%COMP%]   .table-info[_ngcontent-%COMP%]   .record-count[_ngcontent-%COMP%]{font-weight:600;color:#fff}.table-header[_ngcontent-%COMP%]   .table-info[_ngcontent-%COMP%]   .column-count[_ngcontent-%COMP%]{color:#a4abb3;font-size:.875rem}.table-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;white-space:nowrap}.table-container[_ngcontent-%COMP%]{overflow-x:auto;max-width:100%}.table-container.scrollable[_ngcontent-%COMP%]{overflow-x:scroll}.table-container[_ngcontent-%COMP%]::-webkit-scrollbar{height:8px}.table-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#1a1a2e}.table-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#36f;border-radius:4px}.table-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#5280ff}.dynamic-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;min-width:100%}.dynamic-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background-color:#1a1a2e;position:sticky;top:0;z-index:10}.dynamic-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:1rem;text-align:left;font-weight:600;color:#fff;border-bottom:2px solid #3366ff;white-space:nowrap;font-size:.875rem;text-transform:uppercase;letter-spacing:.5px}.dynamic-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-bottom:1px solid rgba(255,255,255,.1);transition:background-color .2s ease}.dynamic-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#3366ff1a}.dynamic-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-child{border-bottom:none}.dynamic-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.875rem 1rem;color:#fff;font-size:.875rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:300px}.dynamic-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.no-data[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:#a4abb3;font-style:italic}@media (max-width: 768px){.table-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.table-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;justify-content:center}.table-info[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.5rem!important}.dynamic-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .dynamic-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem .5rem;font-size:.8rem}}"]})};var G=class i{constructor(t,e){this.http=t;this.plazaService=e}getTableData(t,e){let n=this.plazaService.getApiUrl(e),a=t.dateRange&&(t.dateRange.start||t.dateRange.end),s=t.searchText&&t.searchField,be=a||s?`${n}/api/filtered_data`:`${n}/api/paginated_data`,P={tableName:t.tableName};return a&&(P.dateRange={start:t.dateRange.start||void 0,end:t.dateRange.end||void 0}),t.city&&(P.city=t.city),s&&(P.searchText=t.searchText,P.searchField=t.searchField),t.paginationContext&&(P.paginationContext={page:t.paginationContext.page||1,pageSize:t.paginationContext.pageSize||10}),this.http.post(be,P)}getTableColumns(t,e){let a=`${this.plazaService.getApiUrl(e)}/raw-tables/columns/${t}`;return this.http.get(a)}static \u0275fac=function(e){return new(e||i)(J(ae),J(pe))};static \u0275prov=Q({token:i,factory:i.\u0275fac,providedIn:"root"})};function Ae(i,t){i&1&&(l(0,"div",5),b(1,"nb-spinner",6),r())}var fe=class i{constructor(t){this.rawTablesService=t}selectedPlaza="xalap";selectedTable="VENTA";isLoading=!1;currentFilters=null;currentDateField="FECHA";tableOptions=[{value:"CANOTA",label:"CANOTA"},{value:"CUNOTA",label:"CUNOTA"},{value:"VENTA",label:"VENTA"},{value:"PARTVTA",label:"PARTVTA"},{value:"COBRANZA",label:"COBRANZA"},{value:"XCORTE",label:"XCORTE"},{value:"CLIENTE",label:"CLIENTE"}];currentPage=1;pageSize=20;totalRecords=0;filterConfig={showTextFilter:!0,showDateFilter:!0,lockTextFilter:!1,lockDateFilter:!1,manualApply:!0,fields:[{value:"name",label:"Nombre"},{value:"code",label:"C\xF3digo"},{value:"description",label:"Descripci\xF3n"}],defaultDateRange:{start:"2026-01-01",end:new Date().toISOString().split("T")[0]}};tableColumns=[];tableData=[];ngOnInit(){this.fetchDataFromAPI()}onPlazaChange(t){this.selectedPlaza=t,this.currentPage=1,this.filterConfig={showTextFilter:!0,showDateFilter:!0,lockTextFilter:!1,lockDateFilter:!1,manualApply:!0,fields:[{value:"name",label:"Nombre"},{value:"code",label:"C\xF3digo"},{value:"description",label:"Descripci\xF3n"}],defaultDateRange:{start:"2026-01-01",end:new Date().toISOString().split("T")[0]}},this.currentFilters=null,console.log("Plaza changed to:",t,"Table:",this.selectedTable),this.fetchDataFromAPI()}onFilterChange(t){this.currentFilters=t,this.currentPage=1,console.log("Filters applied:",t),this.fetchDataFromAPI()}onPageChange(t){this.currentPage=t,console.log("Page changed to:",t),this.fetchDataFromAPI()}onTableChange(t){this.selectedTable=t,this.tableColumns=[],this.tableData=[],this.filterConfig={showTextFilter:!0,showDateFilter:!0,lockTextFilter:!1,lockDateFilter:!1,manualApply:!0,fields:[{value:"name",label:"Nombre"},{value:"code",label:"C\xF3digo"},{value:"description",label:"Descripci\xF3n"}],defaultDateRange:{start:"2026-01-01",end:new Date().toISOString().split("T")[0]}},this.currentPage=1,this.currentFilters=null,console.log("Table changed to:",t,"Plaza:",this.selectedPlaza),this.fetchDataFromAPI()}fetchDataFromAPI(){this.isLoading=!0;let t={tableName:this.selectedTable,paginationContext:{page:this.currentPage,pageSize:this.pageSize}};(this.currentFilters?.dateRange?.start||this.currentFilters?.dateRange?.end)&&(t.dateRange={start:this.currentFilters.dateRange?.start||void 0,end:this.currentFilters.dateRange?.end||void 0}),this.currentFilters?.searchText&&this.currentFilters?.selectedField&&(t.searchText=this.currentFilters.searchText,t.searchField=this.currentFilters.selectedField),this.selectedPlaza&&(t.city=this.selectedPlaza),console.log("=== Fetching Data ==="),console.log("Current Page:",this.currentPage),console.log("Page Size:",this.pageSize),console.log("API Request:",t),this.rawTablesService.getTableData(t,this.selectedPlaza).subscribe({next:e=>{if(!e.success){console.error("API returned success: false"),this.isLoading=!1;return}this.tableData=e.data,this.totalRecords=e.pagination.totalRecords,console.log("=== API Response ==="),console.log("Data rows received:",e.data.length),console.log("Total records:",e.pagination.totalRecords),console.log("Current page from API:",e.pagination.page),console.log("Page size from API:",e.pagination.pageSize),e.metadata&&e.metadata.length>0&&(this.tableColumns=e.metadata.map(n=>({key:n.column_name,label:n.column_name,type:this.mapDataTypeToColumnType(n.data_type),width:n.character_maximum_length?`${Math.min(n.character_maximum_length*8,300)}px`:void 0})),this.filterConfig=R(y({},this.filterConfig),{fields:e.metadata.map(n=>({value:n.column_name,label:n.column_name}))})),e.tableConfig&&(this.currentDateField=e.tableConfig.date_field,this.updateFilterConfigForTable(e.tableConfig.date,e.tableConfig.date_field)),this.isLoading=!1,console.log("API Response:",e)},error:e=>{console.error("Error fetching data:",e),this.isLoading=!1}})}updateFilterConfigForTable(t,e){this.filterConfig=R(y({},this.filterConfig),{showDateFilter:t,lockDateFilter:!t}),!t&&this.currentFilters?.dateRange&&(this.currentFilters=R(y({},this.currentFilters),{dateRange:{start:null,end:null}}))}mapDataTypeToColumnType(t){let e=t.toLowerCase();return e.includes("int")||e.includes("decimal")||e.includes("numeric")||e.includes("float")?"number":e.includes("date")||e.includes("time")?"date":e.includes("bool")||e.includes("bit")?"boolean":"text"}static \u0275fac=function(e){return new(e||i)($(G))};static \u0275cmp=w({type:i,selectors:[["app-raw-tables"]],decls:7,vars:11,consts:[[3,"selectedPlazaChange","selectedPlaza"],[3,"filterChange","config"],["class","loading-overlay",4,"ngIf"],[3,"tableChange","columns","data","defaultVisibleColumns","tableOptions","selectedTable"],[3,"pageChange","currentPage","pageSize","totalRecords"],[1,"loading-overlay"],["size","large","status","primary","message","Cargando datos..."]],template:function(e,n){e&1&&(l(0,"app-plaza-selector",0),_("selectedPlazaChange",function(s){return h(n.selectedPlaza,s)||(n.selectedPlaza=s),s}),m("selectedPlazaChange",function(s){return n.onPlazaChange(s)}),r(),l(1,"app-advanced-filter",1),m("filterChange",function(s){return n.onFilterChange(s)}),r(),l(2,"nb-card")(3,"nb-card-body"),g(4,Ae,2,0,"div",2),l(5,"app-dynamic-table",3),m("tableChange",function(s){return n.onTableChange(s)}),r(),l(6,"app-table-pagination",4),m("pageChange",function(s){return n.onPageChange(s)}),r()()()),e&2&&(C("selectedPlaza",n.selectedPlaza),o(),c("config",n.filterConfig),o(3),c("ngIf",n.isLoading),o(),c("columns",n.tableColumns)("data",n.tableData)("defaultVisibleColumns",10)("tableOptions",n.tableOptions)("selectedTable",n.selectedTable),o(),c("currentPage",n.currentPage)("pageSize",n.pageSize)("totalRecords",n.totalRecords))},dependencies:[v,T,D,B,E,F,I,W,S,se,re,O,de,X,Z,ce],styles:["nb-card-body[_ngcontent-%COMP%]{position:relative;min-height:400px}.loading-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1rem;background-color:#00000080;backdrop-filter:blur(2px);z-index:1000}.loading-overlay[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff;font-size:1rem;font-weight:500;margin:0;white-space:nowrap;text-align:center}"]})};export{fe as RawTablesComponent};
